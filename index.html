<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NK Music Player - Interactive Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Montserrat:wght@400;600&display=swap');
        
        :root {
            --primary: #00f0ff;
            --bg-dark: #05050a;
            --glow: rgba(0, 240, 255, 0.4);
        }

        body.theme-1 { --primary: #00f0ff; --glow: rgba(0, 240, 255, 0.4); }
        body.theme-2 { --primary: #ffd700; --glow: rgba(255, 215, 0, 0.4); }
        body.theme-3 { --primary: #ff00e6; --glow: rgba(255, 0, 230, 0.4); }
        body.theme-4 { --primary: #00ff9d; --glow: rgba(0, 255, 157, 0.4); }
        body.theme-5 { --primary: #ff3e3e; --glow: rgba(255, 62, 62, 0.4); }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-dark);
            color: white;
            transition: background 0.5s;
            min-height: 100vh;
            cursor: crosshair; /* Fallback cursor */
            overflow-x: hidden;
        }

        /* CUSTOM CURSOR FIXED */
        #cursor-dot {
            width: 8px; height: 8px; background: var(--primary);
            position: fixed; border-radius: 50%; z-index: 10000;
            pointer-events: none; transform: translate(-50%, -50%);
            box-shadow: 0 0 15px var(--primary);
        }
        #cursor-outline {
            width: 40px; height: 40px; border: 2px solid var(--primary);
            position: fixed; border-radius: 50%; z-index: 9999;
            pointer-events: none; transform: translate(-50%, -50%);
            transition: width 0.2s, height 0.2s, border-color 0.4s;
            opacity: 0.6;
        }
        
        /* Cursor behavior on clickable elements */
        .clickable:hover ~ #cursor-outline, button:hover ~ #cursor-outline, a:hover ~ #cursor-outline {
            width: 60px; height: 60px; background: rgba(255,255,255,0.1);
        }

        .futuristic-font { font-family: 'Orbitron', sans-serif; }
        
        #visualizer-wrapper {
            position: relative; width: 450px; height: 450px;
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.1s ease;
        }

        #album-art-container {
            width: 260px; height: 260px; border-radius: 50%; overflow: hidden;
            border: 5px solid var(--primary); box-shadow: 0 0 40px var(--glow);
            z-index: 5; background: #111; display: flex; align-items: center; justify-content: center;
        }

        #album-art-container img { width: 100%; height: 100%; object-fit: cover; }
        .emoji-icon { font-size: 100px; color: var(--primary); }

        canvas { position: absolute; top: 0; left: 0; }
        .bass-hit { transform: scale(1.08); }

        #progress-bar { appearance: none; height: 10px; background: #111; border-radius: 10px; overflow: hidden; cursor: pointer; }
        #progress-bar::-webkit-slider-thumb { appearance: none; width: 0; box-shadow: -1000px 0 0 1000px var(--primary); }

        .neon-btn { border: 2px solid var(--primary); color: var(--primary); transition: 0.3s; background: transparent; }
        .neon-btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 25px var(--primary); }

        .social-icon { font-size: 32px; transition: 0.3s; color: white; }
        .social-icon:hover { transform: translateY(-8px); color: var(--primary); filter: drop-shadow(0 0 10px var(--primary)); }
    </style>
</head>
<body class="theme-1">
    <div id="cursor-dot"></div>
    <div id="cursor-outline"></div>

    <div id="particles-js" class="fixed inset-0 -z-10"></div>
    
    <div id="main-container" class="container mx-auto px-4 py-8">
        <header class="flex flex-col md:flex-row justify-between items-center mb-12 gap-6">
            <h1 class="text-5xl font-bold futuristic-font tracking-tighter">NK <span style="color:var(--primary)">PULSE</span></h1>
            <div class="flex gap-4">
                <button onclick="toggleFullScreen()" class="neon-btn px-6 py-2 rounded-full text-xs uppercase font-bold">
                    <i class="fas fa-expand mr-2"></i> Full Screen
                </button>
                <button onclick="nextTheme()" class="neon-btn px-6 py-2 rounded-full text-xs uppercase font-bold">
                    <i class="fas fa-magic mr-2"></i> Cycle Theme
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
            <div class="flex justify-center">
                <div id="visualizer-wrapper">
                    <div id="album-art-container">
                        <div id="art-placeholder"><i class="fas fa-music emoji-icon"></i></div>
                        <img id="track-art" src="" class="hidden">
                    </div>
                    <canvas id="visualizer-canvas" width="450" height="450"></canvas>
                </div>
            </div>

            <div class="bg-white/5 backdrop-blur-2xl p-10 rounded-[40px] border-b-8 shadow-2xl" style="border-color: var(--primary);">
                <div class="text-center mb-10">
                    <h2 id="current-song" class="text-3xl font-bold truncate futuristic-font">NK Music Player</h2>
                    <p id="current-artist" class="opacity-60 text-lg mt-2">NK Siyol Edition</p>
                </div>

                <div class="flex justify-center items-center gap-12 mb-10">
                    <button id="prev-btn" class="text-3xl hover:scale-125 transition" style="color:var(--primary)"><i class="fas fa-backward-step"></i></button>
                    <button id="play-btn" class="w-24 h-24 rounded-full border-4 flex items-center justify-center text-4xl hover:scale-110 transition" style="border-color:var(--primary); box-shadow: 0 0 25px var(--glow)">
                        <i class="fas fa-play"></i>
                    </button>
                    <button id="next-btn" class="text-3xl hover:scale-125 transition" style="color:var(--primary)"><i class="fas fa-forward-step"></i></button>
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between text-sm font-bold futuristic-font" style="color:var(--primary)">
                        <span id="current-time">00:00</span>
                        <span id="total-time">00:00</span>
                    </div>
                    <input type="range" id="progress-bar" class="w-full" value="0">
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-10 mt-16">
            <div id="drop-zone" class="p-16 rounded-[30px] border-2 border-dashed flex flex-col items-center justify-center cursor-pointer hover:bg-white/5 transition" style="border-color:var(--primary)">
                <i class="fas fa-cloud-arrow-up text-6xl mb-6" style="color:var(--primary)"></i>
                <h3 class="text-2xl font-bold futuristic-font">UPLOAD MP3</h3>
                <input type="file" id="file-input" multiple class="hidden" accept="audio/*">
            </div>
            <div class="bg-white/5 p-8 rounded-[30px]">
                <h3 class="futuristic-font text-xs mb-6 opacity-60">PLAYLIST</h3>
                <ul id="playlist" class="space-y-3 max-h-48 overflow-y-auto pr-4"></ul>
            </div>
        </div>

        <footer class="mt-20 pb-10 flex flex-col items-center">
            <div class="flex gap-12 mb-8">
                <a href="https://instagram.com/nk.siyol" target="_blank" class="social-icon"><i class="fab fa-instagram"></i></a>
                <a href="https://t.me/nk_siyol" target="_blank" class="social-icon"><i class="fab fa-telegram"></i></a>
            </div>
            <p class="opacity-20 text-[10px] text-center">NK Music Player Â© 2026 | Designed by NK Siyol</p>
        </footer>
    </div>

    <script>
        // CURSOR SCRIPT FIXED
        const dot = document.getElementById('cursor-dot');
        const outline = document.getElementById('cursor-outline');

        window.addEventListener('mousemove', (e) => {
            const posX = e.clientX;
            const posY = e.clientY;

            dot.style.left = `${posX}px`;
            dot.style.top = `${posY}px`;

            // Smooth delay for outline
            outline.animate({
                left: `${posX}px`,
                top: `${posY}px`
            }, { duration: 400, fill: "forwards" });
        });

        // Theme and Audio Logic (Same as before)
        let themeIdx = 1;
        function nextTheme() {
            document.body.classList.remove(`theme-${themeIdx}`);
            themeIdx = themeIdx >= 5 ? 1 : themeIdx + 1;
            document.body.classList.add(`theme-${themeIdx}`);
            const primary = getComputedStyle(document.body).getPropertyValue('--primary').trim();
            if(window.pJSDom[0]) { window.pJSDom[0].pJS.particles.color.value = primary; window.pJSDom[0].pJS.fn.particlesRefresh(); }
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) { document.documentElement.requestFullscreen(); } 
            else { document.exitFullscreen(); }
        }

        const audio = new Audio();
        let audioContext, analyser, dataArray, source;
        let tracks = [];
        let currentTrackIndex = -1;
        const canvas = document.getElementById('visualizer-canvas');
        const ctx = canvas.getContext('2d');

        function initAudio() {
            if (audioContext) return;
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            source = audioContext.createMediaElementSource(audio);
            source.connect(analyser);
            analyser.connect(audioContext.destination);
            analyser.fftSize = 256;
            dataArray = new Uint8Array(analyser.frequencyBinCount);
            draw();
        }

        function draw() {
            requestAnimationFrame(draw);
            if (!analyser || audio.paused) return;
            analyser.getByteFrequencyData(dataArray);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 145; 
            
            if (dataArray[2] > 215) document.getElementById('visualizer-wrapper').classList.add('bass-hit');
            else document.getElementById('visualizer-wrapper').classList.remove('bass-hit');

            for (let i = 0; i < 120; i++) {
                let angle = (i * 2 * Math.PI) / 120;
                let val = dataArray[i % 60];
                let barLen = (val / 255) * 110;
                let xStart = centerX + Math.cos(angle) * radius;
                let yStart = centerY + Math.sin(angle) * radius;
                let xEnd = centerX + Math.cos(angle) * (radius + barLen);
                let yEnd = centerY + Math.sin(angle) * (radius + barLen);
                ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--primary');
                ctx.lineWidth = 3; ctx.lineCap = "round";
                ctx.beginPath(); ctx.moveTo(xStart, yStart); ctx.lineTo(xEnd, yEnd); ctx.stroke();
            }
        }

        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        dropZone.onclick = () => fileInput.click();
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.style.background = 'rgba(255,255,255,0.05)'; });
        dropZone.addEventListener('dragleave', () => dropZone.style.background = 'transparent');
        dropZone.addEventListener('drop', (e) => { e.preventDefault(); handleFiles(e.dataTransfer.files); });
        fileInput.onchange = (e) => handleFiles(e.target.files);

        function handleFiles(files) {
            for (let file of files) { if (file.type.startsWith('audio/')) tracks.push({ name: file.name, url: URL.createObjectURL(file), file: file }); }
            updatePlaylist();
            if (currentTrackIndex === -1 && tracks.length > 0) playTrack(0);
        }

        function playTrack(idx) {
            initAudio();
            currentTrackIndex = idx;
            audio.src = tracks[idx].url;
            audio.play();
            document.getElementById('current-song').textContent = tracks[idx].name;
            document.getElementById('play-btn').innerHTML = '<i class="fas fa-pause"></i>';
            window.jsmediatags.read(tracks[idx].file, {
                onSuccess: function(tag) {
                    const data = tag.tags.picture;
                    if (data) {
                        const base64 = `data:${data.format};base64,${btoa(data.data.map(c => String.fromCharCode(c)).join(""))}`;
                        document.getElementById('track-art').src = base64;
                        document.getElementById('track-art').classList.remove('hidden');
                        document.getElementById('art-placeholder').classList.add('hidden');
                    } else { resetArt(); }
                },
                onError: () => resetArt()
            });
            updatePlaylist();
        }

        function resetArt() {
            document.getElementById('track-art').classList.add('hidden');
            document.getElementById('art-placeholder').classList.remove('hidden');
        }

        document.getElementById('play-btn').onclick = () => {
            if(tracks.length === 0) return;
            initAudio();
            if (audio.paused) { audio.play(); document.getElementById('play-btn').innerHTML = '<i class="fas fa-pause"></i>'; }
            else { audio.pause(); document.getElementById('play-btn').innerHTML = '<i class="fas fa-play"></i>'; }
        };

        function updatePlaylist() {
            document.getElementById('playlist').innerHTML = tracks.map((t, i) => `
                <li onclick="playTrack(${i})" class="flex justify-between items-center p-4 rounded-xl cursor-pointer ${i === currentTrackIndex ? 'bg-white/10' : 'hover:bg-white/5'}">
                    <span class="text-xs truncate w-4/5">${t.name}</span>
                    <i class="fas ${i === currentTrackIndex ? 'fa-chart-simple' : 'fa-play'}" style="color:var(--primary)"></i>
                </li>
            `).join('');
        }

        audio.ontimeupdate = () => {
            const prog = (audio.currentTime / audio.duration) * 100;
            document.getElementById('progress-bar').value = prog || 0;
            document.getElementById('current-time').textContent = formatTime(audio.currentTime);
            document.getElementById('total-time').textContent = formatTime(audio.duration || 0);
        };

        function formatTime(s) { const m = Math.floor(s/60); const sec = Math.floor(s%60); return `${m}:${sec < 10 ? '0' : ''}${sec}`; }

        document.getElementById('progress-bar').oninput = (e) => audio.currentTime = (e.target.value / 100) * audio.duration;
        document.getElementById('next-btn').onclick = () => { if(currentTrackIndex < tracks.length -1) playTrack(currentTrackIndex+1) };
        document.getElementById('prev-btn').onclick = () => { if(currentTrackIndex > 0) playTrack(currentTrackIndex-1) };

        particlesJS('particles-js', {
            particles: { number: { value: 60 }, color: { value: '#00f0ff' }, line_linked: { enable: true, opacity: 0.1 }, move: { speed: 2 } }
        });
    </script>
</body>
</html>
